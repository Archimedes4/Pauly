{"ast":null,"code":"import _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport View from \"react-native-web/dist/exports/View\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport callMsGraph from \"../../Functions/microsoftAssets\";\nimport { accessTokenContent } from \"../../../App\";\nimport { siteID } from \"../../PaulyConfig\";\nimport { useParams } from 'react-router-native';\nimport { useMsal } from '@azure/msal-react';\nimport * as Location from 'expo-location';\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nexport default function CommissionsView() {\n  var pageData = useContext(accessTokenContent);\n  var _useMsal = useMsal(),\n    instance = _useMsal.instance,\n    accounts = _useMsal.accounts;\n  var _useState = useState(undefined),\n    _useState2 = _slicedToArray(_useState, 2),\n    commissionData = _useState2[0],\n    setCommissionData = _useState2[1];\n  var _useParams = useParams(),\n    id = _useParams.id;\n  function getCommissionInformation() {\n    return _getCommissionInformation.apply(this, arguments);\n  }\n  function _getCommissionInformation() {\n    _getCommissionInformation = _asyncToGenerator(function* () {\n      var result = yield callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/sites/\" + siteID + \"/lists/15357035-e94e-4664-b6a4-26e641f0f509/items?expand=fields&filter=fields/CommissionID%20eq%20'\" + id + \"'\", instance, accounts);\n      if (result.ok) {\n        var data = yield result.json();\n        console.log(data);\n        setCommissionData({\n          title: data[\"value\"][0][\"fields\"][\"Title\"],\n          startDate: new Date(data[\"value\"][0][\"fields\"][\"StartDate\"]),\n          endDate: new Date(data[\"value\"][0][\"fields\"][\"EndDate\"]),\n          points: data[\"value\"][0][\"fields\"][\"Points\"],\n          hidden: data[\"value\"][0][\"fields\"][\"Hidden\"],\n          commissionId: data[\"value\"][0][\"fields\"][\"CommissionID\"],\n          proximity: data[\"value\"][0][\"fields\"][\"Proximity\"],\n          coordinateLat: data[\"value\"][0][\"fields\"][\"CoordinateLat\"],\n          coordinateLng: data[\"value\"][0][\"fields\"][\"CoordinateLng\"]\n        });\n      } else {\n        console.log(\"Error occured\");\n      }\n    });\n    return _getCommissionInformation.apply(this, arguments);\n  }\n  function claimCommission() {\n    return _claimCommission.apply(this, arguments);\n  }\n  function _claimCommission() {\n    _claimCommission = _asyncToGenerator(function* () {\n      if (commissionData !== undefined) {\n        var userResult = yield callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/me\", instance, accounts);\n        if (userResult.ok) {\n          var userData = yield userResult.json();\n          var currentTime = new Date();\n          var data = {\n            \"fields\": {\n              \"Title\": userData[\"id\"],\n              \"Submitted\": currentTime.toDateString(),\n              \"UserID\": userData[\"id\"]\n            }\n          };\n          var result = yield callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/sites/\" + siteID + \"/lists/\" + commissionData.commissionId + \"/items\", instance, accounts, \"POST\", false, JSON.stringify(data));\n        }\n      }\n    });\n    return _claimCommission.apply(this, arguments);\n  }\n  function getUsersLocation() {\n    return _getUsersLocation.apply(this, arguments);\n  }\n  function _getUsersLocation() {\n    _getUsersLocation = _asyncToGenerator(function* () {\n      var _yield$Location$reque = yield Location.requestForegroundPermissionsAsync(),\n        status = _yield$Location$reque.status;\n      if (status !== 'granted') {\n        console.log('Permission to access location was denied');\n        return;\n      }\n      var location = yield Location.getCurrentPositionAsync({});\n    });\n    return _getUsersLocation.apply(this, arguments);\n  }\n  useEffect(function () {\n    getCommissionInformation();\n  }, [id]);\n  return _jsxs(View, {\n    children: [_jsx(Text, {\n      children: \"Commission\"\n    }), commissionData === undefined ? _jsx(View, {\n      children: _jsx(Text, {\n        children: \"Loading\"\n      })\n    }) : _jsx(View, {\n      children: _jsx(Text, {\n        children: commissionData.title\n      })\n    }), _jsx(Button, {\n      title: \"Claim Commission\",\n      onPress: function onPress() {\n        claimCommission;\n      }\n    })]\n  });\n}","map":{"version":3,"names":["React","useContext","useEffect","useState","callMsGraph","accessTokenContent","siteID","useParams","useMsal","Location","jsx","_jsx","jsxs","_jsxs","CommissionsView","pageData","_useMsal","instance","accounts","_useState","undefined","_useState2","_slicedToArray","commissionData","setCommissionData","_useParams","id","getCommissionInformation","_getCommissionInformation","apply","arguments","_asyncToGenerator","result","microsoftAccessToken","accessToken","ok","data","json","console","log","title","startDate","Date","endDate","points","hidden","commissionId","proximity","coordinateLat","coordinateLng","claimCommission","_claimCommission","userResult","userData","currentTime","toDateString","JSON","stringify","getUsersLocation","_getUsersLocation","_yield$Location$reque","requestForegroundPermissionsAsync","status","location","getCurrentPositionAsync","View","children","Text","Button","onPress"],"sources":["/Users/andrewmainella/Desktop/Pauly/src/AuthenticatedView/Commissions/CommissionsView.tsx"],"sourcesContent":["import { View, Text, Button } from 'react-native'\nimport React, { useContext, useEffect, useState } from 'react'\nimport callMsGraph from '../../Functions/microsoftAssets'\nimport { accessTokenContent } from '../../../App';\nimport { siteID } from '../../PaulyConfig';\nimport { useParams } from 'react-router-native';\nimport { useMsal } from '@azure/msal-react';\nimport * as Location from 'expo-location';\n\nexport default function CommissionsView() {\n  const pageData = useContext(accessTokenContent);\n  const { instance, accounts } = useMsal();\n  const [commissionData, setCommissionData] = useState<commissionType | undefined>(undefined)\n  const { id } = useParams()\n  async function getCommissionInformation() {\n    const result = await callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/sites/\" + siteID + \"/lists/15357035-e94e-4664-b6a4-26e641f0f509/items?expand=fields&filter=fields/CommissionID%20eq%20'\"+ id +\"'\", instance, accounts)\n    if (result.ok){\n      const data = await result.json()\n      console.log(data)\n      setCommissionData({\n        title: data[\"value\"][0][\"fields\"][\"Title\"],\n        startDate: new Date(data[\"value\"][0][\"fields\"][\"StartDate\"]),\n        endDate: new Date(data[\"value\"][0][\"fields\"][\"EndDate\"]),\n        points: data[\"value\"][0][\"fields\"][\"Points\"],\n        hidden: data[\"value\"][0][\"fields\"][\"Hidden\"],\n        commissionId: data[\"value\"][0][\"fields\"][\"CommissionID\"],\n        proximity: data[\"value\"][0][\"fields\"][\"Proximity\"],\n        coordinateLat: data[\"value\"][0][\"fields\"][\"CoordinateLat\"],\n        coordinateLng: data[\"value\"][0][\"fields\"][\"CoordinateLng\"]\n      })\n    } else {\n      //TO DO error occured\n      console.log(\"Error occured\")\n    }\n  }\n  async function claimCommission() {\n    if (commissionData !== undefined) {\n      const userResult = await callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/me\", instance, accounts)\n      if (userResult.ok){\n        const userData = await userResult.json()\n        const currentTime = new Date\n        const data = {\n          \"fields\": {\n            \"Title\":userData[\"id\"],\n            \"Submitted\":currentTime.toDateString(),\n            \"UserID\":userData[\"id\"]\n          }\n        }\n        const result = await callMsGraph(microsoftAccessToken.accessToken, \"https://graph.microsoft.com/v1.0/sites/\" + siteID + \"/lists/\" + commissionData.commissionId + \"/items\", instance, accounts, \"POST\", false, JSON.stringify(data))\n        \n      }\n    }\n  }\n  async function getUsersLocation(){\n    let { status } = await Location.requestForegroundPermissionsAsync();\n    if (status !== 'granted') {\n      console.log('Permission to access location was denied')\n      return;\n    }\n\n    let location = await Location.getCurrentPositionAsync({});\n  }\n\n  useEffect(() => {getCommissionInformation()}, [id])\n  return (\n    <View>\n      <Text>Commission</Text>\n      { (commissionData === undefined) ?\n        <View>\n          <Text>Loading</Text>\n        </View>:\n        <View>\n          <Text>{commissionData.title}</Text>\n        </View>\n      }\n      <Button title='Claim Commission' onPress={() => {claimCommission}}/>\n    </View>\n  )\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}